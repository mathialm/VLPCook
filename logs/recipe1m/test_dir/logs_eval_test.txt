[I 2025-03-21 14:52:14] ...ytorch/bootstrap/run.py.73: Saving environment info
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75: options: 
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   dataset:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     aux_kw_path:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     batch_sampler: triplet_classif
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     batch_size: 100
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     database: lmdb
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     debug: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     eval_split: test
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     freq_mismatch: 0.0
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     image_from: database
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     import: recipe1m.datasets.factory
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     kw_path:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     name: recipe1m
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     nb_classes: 1048
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     nb_threads: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     randkw_p: 0.3
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     randkw_p_aux: 0.5
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     tokenized_raw_text: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     train_split: None
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     use_vcs: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   engine:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     debug: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     name: logger
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     nb_epochs: 120
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     print_freq: 10
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   exp:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     dir: logs/recipe1m/test_dir
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   misc:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     cuda: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     data_parrallel: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     logs_name: None
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     overrite: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     seed: 1338
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   model:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     criterion:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_encoder: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_encoder_params:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         tri_cross_encoder: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       itm_loss_weight: 1
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       keep_background: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       name: trijoint
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       retrieval_strategy:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         aggregation: valid
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         get_tokens: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         margin: 0.05
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         margin_params:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:           increment: 0.005
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:           increment_margin: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:           max_margin: 0.3
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         name: triplet
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         nb_samples: 9999
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         sampling: max_negative
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     import: recipe1m.models.factory
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     metric:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       k_test: 10
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       name: trijoint
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       nb_bags: 10
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       nb_matchs_per_bag: 1000
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       retrieval_dir: /tmp/recipe1m
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       save_ids: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       trijoint: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     name: trijoint
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     network:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       activations: ['tanh', 'normalize']
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       aux_kwords: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       aux_kwords_encoder: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       avg_concat: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cat_pos: 0
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       checkpoint: None
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       class_attention: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       class_attention_fus: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cls_token: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cls_token_fus: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_decoder_image: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_decoder_recipe: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_encoder: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_encoder_params:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         class_attention: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         cls_token: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         cross_attention: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         cross_decoder: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         double_decoder: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         get_tokens: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         load_backbones: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         n_heads: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         n_layers: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:         query_img: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       cross_transformer: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       dim_emb: 1024
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       dim_image_out: 2048
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       dim_ingr_out: 300
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       dim_instr_in: 1024
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       dim_instr_out: 1024
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       freeze_im: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       freeze_rec: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       get_tokens: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       get_tokens_cross_decoder_recipe: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       hidden_size: 512
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       image_backbone_name: clip
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       image_res: 224
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       kwords_same_level: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       last_cat_aux: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_heads: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_heads_cross: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_heads_cross_image: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_heads_single: 4
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_layers: 2
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_layers_cross: 2
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_layers_cross_image: 1
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       n_layers_single: 2
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       name: trijoint
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       num_hidden_layers_kw: 2
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       old: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       remove_additional_embedding: ['proj_image']
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       text_encoder: bert-base-uncased
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       vision_width: 768
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       vit_all_tokens: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       with_ingrs: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       with_instrs: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:       with_titles: True
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     with_classif: False
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   optimizer:
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     batch_size_factor: None
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     clip_grad: 8.0
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     import: recipe1m.optimizers.factory
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     lr: 1e-05
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     lr_img: 1e-06
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     name: trijoint_fixed_fine_tune
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:     switch_epoch: 20
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-21 14:52:31] ...ytorch/bootstrap/run.py.75:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-21 14:52:32] ...ytorch/bootstrap/run.py.76: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-21 14:52:32] ...ytorch/bootstrap/run.py.80: Available GPUs: [0]
[E 2025-03-21 14:52:32] ...torch/bootstrap/run.py.201: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 186, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 84, in run
    engine = engines.factory()
AttributeError: module 'bootstrap.engines' has no attribute 'factory'

[I 2025-03-21 14:57:11] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-21 14:57:13] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-21 14:57:13] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-21 14:57:13] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-21 14:57:13] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 14, in factory
    module = importlib.import_module(Options()['dataset']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 2, in <module>
    from .recipe1m import Recipe1M
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 2, in <module>
    import lmdb
ModuleNotFoundError: No module named 'lmdb'

[I 2025-03-21 14:57:50] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-21 14:57:52] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-21 14:57:53] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-21 14:57:53] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-21 14:57:53] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-21 14:57:53] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-21 14:57:55] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 14, in factory
    module = importlib.import_module(Options()['dataset']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 4, in <module>
    from .tokenization_bert import BertTokenizer
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/tokenization_bert.py", line 23, in <module>
    from transformers.tokenization_utils import PreTrainedTokenizer, _is_control, _is_punctuation, _is_whitespace
ModuleNotFoundError: No module named 'transformers'

[I 2025-03-21 15:07:25] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-21 15:07:27] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-21 15:07:27] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-21 15:07:27] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-21 15:07:31] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 14, in factory
    module = importlib.import_module(Options()['dataset']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 8, in <module>
    from .randaugment import RandomAugment
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/randaugment.py", line 1, in <module>
    import cv2
ModuleNotFoundError: No module named 'cv2'

[I 2025-03-24 11:05:47] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-24 11:06:03] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-24 11:06:04] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-24 11:06:04] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-24 11:06:04] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-24 11:06:13] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 14, in factory
    module = importlib.import_module(Options()['dataset']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 8, in <module>
    from .randaugment import RandomAugment
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/randaugment.py", line 1, in <module>
    import cv2
ModuleNotFoundError: No module named 'cv2'

[I 2025-03-24 11:20:27] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-24 11:20:30] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-24 11:20:30] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-24 11:20:30] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-24 11:20:30] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 14, in factory
    module = importlib.import_module(Options()['dataset']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 8, in <module>
    from .randaugment import RandomAugment
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/randaugment.py", line 1, in <module>
    import cv2
ModuleNotFoundError: No module named 'cv2'

[I 2025-03-24 11:35:30] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-24 11:35:34] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-24 11:35:35] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-24 11:35:35] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-24 11:35:35] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-24 11:35:35] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-24 11:35:58] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 122, in factory_recipe1m
    Options()['dataset']['dir'],
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/lib/options.py", line 30, in __getitem__
    return OrderedDict.__getitem__(self, key)
KeyError: 'dir'

[I 2025-03-24 11:38:38] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets64/Recipe1M/clean
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-24 11:38:39] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     overrite: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/vlpcook_clip_finetune.yaml
[S 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-07', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-24 11:38:40] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-24 11:38:40] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-24 11:38:40] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-24 11:38:41] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 374, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 79, in __init__
    self.envs['ids'] = lmdb.open(self.path_envs['ids'], readonly=True, lock=False)
lmdb.Error: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets64/Recipe1M/clean/data_lmdb/test/ids.lmdb: No such file or directory

[I 2025-03-25 11:34:22] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets64/Recipe1M/clean
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     image_from: pil_loader
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       image_res: 64
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:34:36] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:34:36] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:34:36] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-25 11:35:03] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 374, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 79, in __init__
    self.envs['ids'] = lmdb.open(self.path_envs['ids'], readonly=True, lock=False)
lmdb.Error: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets64/Recipe1M/clean/data_lmdb/test/ids.lmdb: No such file or directory

[I 2025-03-25 11:37:44] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/clean/lmdb
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:37:46] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:37:46] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:37:46] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-25 11:37:48] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 374, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 79, in __init__
    self.envs['ids'] = lmdb.open(self.path_envs['ids'], readonly=True, lock=False)
lmdb.Error: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/clean/lmdb/data_lmdb/test/ids.lmdb: No such file or directory

[I 2025-03-25 11:38:37] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:38:39] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:38:39] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:38:39] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-25 11:38:41] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 374, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 79, in __init__
    self.envs['ids'] = lmdb.open(self.path_envs['ids'], readonly=True, lock=False)
lmdb.Error: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb/data_lmdb/test/ids.lmdb: No such file or directory

[I 2025-03-25 11:42:50] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:42:52] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:42:52] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:42:52] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-25 11:42:53] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 380, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 85, in __init__
    self.envs['ids'] = lmdb.open(self.path_envs['ids'], readonly=True, lock=False)
lmdb.Error: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb/data_lmdb/test/ids.lmdb: No such file or directory

[I 2025-03-25 11:43:25] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:43:27] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:43:27] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:43:27] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-25 11:43:29] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 380, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 85, in __init__
    self.envs['ids'] = lmdb.open(self.path_envs['ids'], readonly=True, lock=False)
lmdb.Error: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb/data_lmdb/test/ids.lmdb: No such file or directory

[I 2025-03-25 11:44:34] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:44:36] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:44:37] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:44:37] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:44:37] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:44:37] ...trap/datasets/factory.py.8: Creating dataset...
[E 2025-03-25 11:44:38] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 374, in __init__
    super(Recipe1M, self).__init__(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 91, in __init__
    with open(self.path_pkl, 'rb') as f:
FileNotFoundError: [Errno 2] No such file or directory: '/cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/lmdb/classes1M.pkl'

[I 2025-03-25 11:45:27] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:45:29] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:45:30] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:45:30] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:45:30] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:45:30] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 11:45:32] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 11:45:33] ...m/datasets/recipe1m.py.165: randkw_p... None
[E 2025-03-25 11:45:34] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 384, in __init__
    self.recipes_dataset = Recipes_raw(dir_data, split, batch_size, nb_threads)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 304, in __init__
    with open(self.path_layer1, 'r') as f:
FileNotFoundError: [Errno 2] No such file or directory: '/cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/tokenized_layer1.json'

[I 2025-03-25 11:46:53] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:46:55] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:46:55] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:46:55] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 11:46:58] ...m/datasets/recipe1m.py.152: Load VCs...
[E 2025-03-25 11:46:58] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 380, in __init__
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 153, in __init__
    self.image_path_to_kws = json.load(open(kw_path,'r'))
FileNotFoundError: [Errno 2] No such file or directory: 'data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json'

[I 2025-03-25 11:48:07] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:48:09] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:48:10] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:48:10] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:48:10] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 11:48:12] ...m/datasets/recipe1m.py.152: Load VCs...
[E 2025-03-25 11:48:12] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 380, in __init__
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 153, in __init__
    self.image_path_to_kws = json.load(open(kw_path,'r'))
FileNotFoundError: [Errno 2] No such file or directory: 'data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json'

[I 2025-03-25 11:51:24] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       test: data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       train: data_dir/recipe1m/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       val: data_dir/recipe1m/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       bert_config: ~/vlpcook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       path_ingrs: data_dir/recipe1m/text/vocab.pkl
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       path_vocab: data_dir/recipe1m/text/vocab_all.txt
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:51:26] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:51:26] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:51:26] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 11:51:29] ...m/datasets/recipe1m.py.152: Load VCs...
[E 2025-03-25 11:51:29] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 89, in run
    engine.dataset = datasets.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/datasets/factory.py", line 15, in factory
    dataset = module.factory(engine=engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 24, in factory
    dataset['eval'] = factory_recipe1m(Options()['dataset']['eval_split'])
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/factory.py", line 132, in factory_recipe1m
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 380, in __init__
    random_kw=random_kw, random_aux_kw=random_aux_kw)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/datasets/recipe1m.py", line 153, in __init__
    self.image_path_to_kws = json.load(open(kw_path,'r'))
FileNotFoundError: [Errno 2] No such file or directory: 'data_dir/recipe1m/context_annotation/layer1_test_ingr_kw.json'

[I 2025-03-25 11:53:07] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:53:09] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:53:09] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:53:09] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 11:53:12] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 11:53:12] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 11:54:15] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 11:54:15] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 11:54:15] ...strap/models/factory.py.21: Creating model...
[E 2025-03-25 11:54:15] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 24, in factory
    module = importlib.import_module(Options()['model']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 2, in <module>
    from .trijoint import Trijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 7, in <module>
    from . import networks
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/__init__.py", line 1, in <module>
    from .trijoint import  CrossTrijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 6, in <module>
    from .image_networks.networks import ImageEmbedding
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/image_networks/networks.py", line 1, in <module>
    import pretrainedmodels
ModuleNotFoundError: No module named 'pretrainedmodels'

[I 2025-03-25 11:58:45] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 11:58:47] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 11:58:48] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 11:58:48] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 11:58:48] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 11:58:48] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 11:58:51] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 11:58:51] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:00:01] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:00:01] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:00:01] ...strap/models/factory.py.21: Creating model...
[E 2025-03-25 12:00:04] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 24, in factory
    module = importlib.import_module(Options()['model']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 2, in <module>
    from .trijoint import Trijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 7, in <module>
    from . import networks
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/__init__.py", line 1, in <module>
    from .trijoint import  CrossTrijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 7, in <module>
    from .recipe_networks.networks import HTransformerRecipeEmbedding, Transformer, \
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/networks.py", line 10, in <module>
    from .xbert import BertConfig, BertModel, BertEmbeddings
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/xbert.py", line 833, in <module>
    class BertModel(BertPreTrainedModel):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/xbert.py", line 875, in BertModel
    config_class=_CONFIG_FOR_DOC,
TypeError: add_code_sample_docstrings() got an unexpected keyword argument 'tokenizer_class'

[I 2025-03-25 12:02:19] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:02:21] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:02:21] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:02:21] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:02:23] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:02:24] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:03:26] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:03:26] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:03:26] ...strap/models/factory.py.21: Creating model...
[E 2025-03-25 12:03:27] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 24, in factory
    module = importlib.import_module(Options()['model']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 2, in <module>
    from .trijoint import Trijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 7, in <module>
    from . import networks
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/__init__.py", line 1, in <module>
    from .trijoint import  CrossTrijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 7, in <module>
    from .recipe_networks.networks import HTransformerRecipeEmbedding, Transformer, \
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/networks.py", line 10, in <module>
    from .xbert import BertConfig, BertModel, BertEmbeddings
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/xbert.py", line 833, in <module>
    class BertModel(BertPreTrainedModel):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/xbert.py", line 875, in BertModel
    config_class=_CONFIG_FOR_DOC,
TypeError: add_code_sample_docstrings() got an unexpected keyword argument 'tokenizer_class'

[I 2025-03-25 12:06:12] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:06:14] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:06:15] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:06:15] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:06:15] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:06:17] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:06:17] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:07:19] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:07:19] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:07:19] ...strap/models/factory.py.21: Creating model...
[E 2025-03-25 12:07:20] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 24, in factory
    module = importlib.import_module(Options()['model']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 2, in <module>
    from .trijoint import Trijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 7, in <module>
    from . import networks
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/__init__.py", line 1, in <module>
    from .trijoint import  CrossTrijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 7, in <module>
    from .recipe_networks.networks import HTransformerRecipeEmbedding, Transformer, \
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/networks.py", line 10, in <module>
    from .xbert import BertConfig, BertModel, BertEmbeddings
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/xbert.py", line 1344, in <module>
    class BertForMaskedLM(BertPreTrainedModel):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/xbert.py", line 1368, in BertForMaskedLM
    config_class=_CONFIG_FOR_DOC,
TypeError: add_code_sample_docstrings() got an unexpected keyword argument 'tokenizer_class'

[I 2025-03-25 12:12:12] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:12:13] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:12:14] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:12:14] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:12:14] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:12:14] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:12:16] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:12:17] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:13:19] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:13:19] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:13:19] ...strap/models/factory.py.21: Creating model...
[E 2025-03-25 12:13:20] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 24, in factory
    module = importlib.import_module(Options()['model']['import'])
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1006, in _gcd_import
  File "<frozen importlib._bootstrap>", line 983, in _find_and_load
  File "<frozen importlib._bootstrap>", line 967, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 677, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 728, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 2, in <module>
    from .trijoint import Trijoint
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 7, in <module>
    from . import networks
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/__init__.py", line 2, in <module>
    from .vlpcook import VLPCooK
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/vlpcook.py", line 11, in <module>
    from .xbert import BertConfig, BertModel
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/xbert.py", line 833, in <module>
    class BertModel(BertPreTrainedModel):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/xbert.py", line 875, in BertModel
    config_class=_CONFIG_FOR_DOC,
TypeError: add_code_sample_docstrings() got an unexpected keyword argument 'tokenizer_class'

[I 2025-03-25 12:14:49] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:14:50] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:14:51] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:14:51] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:14:51] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:14:51] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:14:53] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:14:54] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:15:56] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:15:56] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:15:56] ...strap/models/factory.py.21: Creating model...
[I 2025-03-25 12:15:57] ...e_networks/networks.py.199: Loading CLIP Visual model...
[E 2025-03-25 12:16:43] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/clip/clip.py", line 129, in load
    model = torch.jit.load(opened_file, map_location=device if jit else "cpu").eval()
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/jit/__init__.py", line 230, in load
    cpp_module = torch._C.import_ir_module_from_buffer(cu, f.read(), map_location, _extra_files)
RuntimeError: version_ <= kMaxSupportedFileFormatVersion INTERNAL ASSERT FAILED at /pytorch/caffe2/serialize/inline_container.cc:132, please report a bug to PyTorch. Attempted to read a PyTorch file with version 4, but the maximum supported version for reading is 3. Your PyTorch installation may be too old.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 25, in factory
    model = module.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 11, in factory
    engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 53, in __init__
    with_classif=opt['with_classif'], opt_all=Options())
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 22, in __init__
    self.image_embedding = ImageEmbedding(opt)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/image_networks/networks.py", line 207, in __init__
    self.convnet = ViT_CLIP_custom(device=self.device)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/image_networks/networks.py", line 40, in __init__
    clip_model, _ = clip.load("ViT-B/16", device=self.device)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/clip/clip.py", line 136, in load
    state_dict = torch.load(opened_file, map_location="cpu")
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/serialization.py", line 593, in load
    return _legacy_load(opened_file, map_location, pickle_module, **pickle_load_args)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/serialization.py", line 763, in _legacy_load
    magic_number = pickle_module.load(f, **pickle_load_args)
EOFError: Ran out of input

[I 2025-03-25 12:26:19] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       recipe_encoder: tfoodvicha-transformer
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:26:21] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:26:21] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:26:21] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:26:24] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:26:25] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:27:31] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:27:31] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:27:31] ...strap/models/factory.py.21: Creating model...
[I 2025-03-25 12:27:32] ...e_networks/networks.py.199: Loading CLIP Visual model...
[E 2025-03-25 12:27:36] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 25, in factory
    model = module.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 11, in factory
    engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 53, in __init__
    with_classif=opt['with_classif'], opt_all=Options())
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 90, in __init__
    self.proj_recipe_to_image = nn.Linear(self.recipe_embedding.hidden_size, self.dim_cross_image)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1270, in __getattr__
    type(self).__name__, name))
AttributeError: 'CrossTrijoint' object has no attribute 'recipe_embedding'

[I 2025-03-25 12:35:25] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       recipe_encoder: bert
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:35:27] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:35:27] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:35:27] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:35:29] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:35:30] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:36:36] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:36:36] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:36:36] ...strap/models/factory.py.21: Creating model...
[I 2025-03-25 12:36:37] ...e_networks/networks.py.199: Loading CLIP Visual model...
[I 2025-03-25 12:36:40] ...e_networks/networks.py.396: cuda
[E 2025-03-25 12:36:41] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 25, in factory
    model = module.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 11, in factory
    engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 53, in __init__
    with_classif=opt['with_classif'], opt_all=Options())
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 29, in __init__
    self.recipe_embedding =  BERTTransformerRecipeEmbedding(opt)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/networks.py", line 423, in __init__
    bert_config = BertConfig.from_json_file(bert_config)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/transformers/configuration_utils.py", line 744, in from_json_file
    config_dict = cls._dict_from_json_file(json_file)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/transformers/configuration_utils.py", line 749, in _dict_from_json_file
    with open(json_file, "r", encoding="utf-8") as reader:
FileNotFoundError: [Errno 2] No such file or directory: '~/poisoning/ML_Poisoning/VLPCook/data_dir/recipe1m/models/networks/recipe_networks/config_bert_albef.json'

[I 2025-03-25 12:37:39] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       bert_config: ~/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       recipe_encoder: bert
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:37:41] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:37:41] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:37:41] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:37:43] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:37:44] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:38:50] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:38:50] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:38:50] ...strap/models/factory.py.21: Creating model...
[I 2025-03-25 12:38:51] ...e_networks/networks.py.199: Loading CLIP Visual model...
[I 2025-03-25 12:38:54] ...e_networks/networks.py.396: cuda
[E 2025-03-25 12:38:54] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 95, in run
    engine.model = models.factory(engine, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/models/factory.py", line 25, in factory
    model = module.factory(engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/factory.py", line 11, in factory
    engine)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/trijoint.py", line 53, in __init__
    with_classif=opt['with_classif'], opt_all=Options())
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/trijoint.py", line 29, in __init__
    self.recipe_embedding =  BERTTransformerRecipeEmbedding(opt)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/networks.py", line 423, in __init__
    bert_config = BertConfig.from_json_file(bert_config)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/transformers/configuration_utils.py", line 744, in from_json_file
    config_dict = cls._dict_from_json_file(json_file)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/transformers/configuration_utils.py", line 749, in _dict_from_json_file
    with open(json_file, "r", encoding="utf-8") as reader:
FileNotFoundError: [Errno 2] No such file or directory: '~/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/config_bert_albef.json'

[I 2025-03-25 12:39:35] ...ytorch/bootstrap/run.py.74: Saving environment info
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76: options: 
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   dataset:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     aux_kw_path:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_titles_kw.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_titles_kw.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_titles_kw.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     batch_sampler: triplet_classif
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     batch_size: 100
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     database: lmdb
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     dir: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     eval_split: test
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     freq_mismatch: 0.0
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     image_from: database
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     import: recipe1m.datasets.factory
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     interchange_ingrd_instr: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     kw_path:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       test: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_test_ingr_kw.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       train: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_train_ingr_kw.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       val: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/context_annotation/layer1_val_ingr_kw.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     name: recipe1m
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     nb_classes: 1048
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     nb_threads: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     randkw_p: 0.3
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     randkw_p_aux: 0.5
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     remove_list: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     tokenized_raw_text: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     train_split: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     use_vcs: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   engine:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     debug: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     name: logger
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     nb_epochs: 120
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     print_freq: 10
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     saving_criteria: ['eval_epoch.metric.med_im2recipe_mean:min', 'eval_epoch.metric.recall_at_1_im2recipe_mean:max']
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   exp:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     checkpoint: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     dir: logs/recipe1m/test_dir
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     resume: best_eval_epoch.metric.recall_at_1_im2recipe_mean
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   misc:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     cuda: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     data_parrallel: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     logs_name: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     overrite: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     seed: 1338
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   model:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     criterion:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         tri_cross_encoder: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       itm_loss_weight: 1
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       keep_background: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       retrieval_strategy:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         aggregation: valid
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         get_tokens: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         margin: 0.05
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         margin_params:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:           increment: 0.005
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:           increment_margin: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:           max_margin: 0.3
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         name: triplet
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         nb_samples: 9999
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         sampling: max_negative
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         substrategy: ['IRR', 'RII', 'SIRR', 'SRII']
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         substrategy_weights: [1.0, 1.0, 0.1, 0.1]
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     import: recipe1m.models.factory
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     metric:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       k_test: 10
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       nb_bags: 10
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       nb_matchs_per_bag: 1000
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       retrieval_dir: /tmp/recipe1m
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       save_ids: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       trijoint: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     name: trijoint
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     network:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       activations: ['tanh', 'normalize']
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       aux_kwords: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       aux_kwords_encoder: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       avg_concat: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       bert_config: /cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/recipe1m/models/networks/recipe_networks/config_bert_albef.json
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cat_pos: 0
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       checkpoint: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       class_attention: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       class_attention_fus: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cls_token: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cls_token_fus: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_decoder_image: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_decoder_recipe: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_encoder: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_encoder_params:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         class_attention: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         cls_token: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         cross_attention: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         cross_decoder: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         double_decoder: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         get_tokens: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         load_backbones: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         n_heads: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         n_layers: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:         query_img: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       cross_transformer: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       dim_emb: 1024
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       dim_image_out: 2048
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       dim_ingr_out: 300
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       dim_instr_in: 1024
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       dim_instr_out: 1024
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       freeze_im: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       freeze_rec: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       get_tokens: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       get_tokens_cross_decoder_recipe: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       hidden_size: 512
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       image_backbone_name: clip
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       image_res: 224
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       kwords_same_level: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       last_cat_aux: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_heads: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_heads_cross: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_heads_cross_image: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_heads_single: 4
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_layers: 2
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_layers_cross: 2
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_layers_cross_image: 1
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       n_layers_single: 2
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       name: trijoint
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       num_hidden_layers_kw: 2
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       old: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       path_ingrs: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab.pkl
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       path_vocab: /cluster/home/mathialm/poisoning/ML_Poisoning/data/datasets/Recipe1M/text/vocab_all.txt
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       recipe_encoder: bert
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       remove_additional_embedding: ['proj_image']
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       text_encoder: bert-base-uncased
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       vision_width: 768
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       vit_all_tokens: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       with_ingrs: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       with_instrs: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:       with_titles: True
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     with_classif: False
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   optimizer:
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     batch_size_factor: None
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     clip_grad: 8.0
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     import: recipe1m.optimizers.factory
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     lr: 1e-05
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     lr_img: 1e-06
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     name: trijoint_fixed_fine_tune
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:     switch_epoch: 20
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   path_opts: bootstrap.pytorch/bootstrap/options/options_eval_test.yaml
[S 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.76:   view: ['logs:train_epoch.loss', 'logs:train_epoch.bad_pairs', 'logs:eval_epoch.metric.med_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_1_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_5_im2recipe_mean', 'logs:eval_epoch.metric.recall_at_10_im2recipe_mean', 'logs:eval_epoch.metric.med_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_1_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_5_recipe2im_mean', 'logs:eval_epoch.metric.recall_at_10_recipe2im_mean', 'logs:optimizer.is_optimizer_recipe&image', 'logs:optimizer.total_norm']
[I 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.77: posix.uname_result(sysname='Linux', nodename='idun-07-10', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed May 1 19:11:28 UTC 2024', machine='x86_64')
[I 2025-03-25 12:39:37] ...ytorch/bootstrap/run.py.81: Available GPUs: [0]
[I 2025-03-25 12:39:37] ...strap/engines/factory.py.9: Creating engine...
[I 2025-03-25 12:39:37] ...trap/datasets/factory.py.8: Creating dataset...
[I 2025-03-25 12:39:39] ...m/datasets/recipe1m.py.152: Load VCs...
[I 2025-03-25 12:39:40] ...m/datasets/recipe1m.py.165: randkw_p... None
[I 2025-03-25 12:40:46] ...m/datasets/recipe1m.py.318: recipe elements to remove: None
[I 2025-03-25 12:40:46] ...rap/datasets/factory.py.21: Evaluation will take place on testset (51334 items)
[I 2025-03-25 12:40:46] ...strap/models/factory.py.21: Creating model...
[I 2025-03-25 12:40:47] ...e_networks/networks.py.199: Loading CLIP Visual model...
[I 2025-03-25 12:40:50] ...e_networks/networks.py.396: cuda
[I 2025-03-25 12:40:59] ...els/metrics/trijoint.py.60: self.save_ids False
[I 2025-03-25 12:40:59] ...strap/models/factory.py.44: Enabling CUDA mode...
[I 2025-03-25 12:41:00] ...otstrap/views/factory.py.8: Creating views...
[I 2025-03-25 12:41:09] ...strap/engines/engine.py.98: Loading best_eval_epoch.metric.recall_at_1_im2recipe_mean checkpoint
[I 2025-03-25 12:41:09] ...trap/engines/engine.py.454: Loading model...
[E 2025-03-25 12:41:09] ...torch/bootstrap/run.py.202: Traceback (most recent call last):
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 187, in main
    run(path_opts=path_opts, rank=rank)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/run.py", line 106, in run
    engine.resume(None if Options().get('misc.cuda', False) else 'cpu')
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/engines/engine.py", line 102, in resume
    map_location=map_location)
  File "/cluster/home/mathialm/poisoning/ML_Poisoning/VLPCook/bootstrap.pytorch/bootstrap/engines/engine.py", line 455, in load
    model_state = torch.load(path_template.format(name, 'model'), map_location=map_location)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/serialization.py", line 771, in load
    with _open_file_like(f, 'rb') as opened_file:
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/serialization.py", line 270, in _open_file_like
    return _open_file(name_or_buffer, mode)
  File "/cluster/home/mathialm/.conda/envs/VLPCook/lib/python3.7/site-packages/torch/serialization.py", line 251, in __init__
    super(_open_file, self).__init__(open(name, mode))
FileNotFoundError: [Errno 2] No such file or directory: 'logs/recipe1m/test_dir/ckpt_best_eval_epoch.metric.recall_at_1_im2recipe_mean_model.pth.tar'

